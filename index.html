<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title> </title>
<style>
  :root{
    --ui-ghost: rgba(255,255,255,0.06);
    --accent: #ff4d6d;
    --neon: rgba(123,97,255,0.85);
    --dialog-bg: rgba(255,255,255,0.95);
    --shadow: 0 10px 30px rgba(0,0,0,0.6);
    font-family: "Vazirmatn", system-ui, -apple-system, Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:#000;overflow:hidden}
  #loadingScreen { position: fixed; inset: 0; background: #000; z-index: 99999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 1s ease-in-out; }
  .loading-content { text-align: center; padding: 2rem; }
  .neon-loader { width: 80px; height: 80px; border-radius: 50%; position: relative; margin: 0 auto 2rem; }
  .neon-loader::before, .neon-loader::after { content: ''; position: absolute; border-radius: 50%; animation: pulse 2s linear infinite; }
  .neon-loader::before { width: 100%; height: 100%; background: linear-gradient(45deg, #ff4d6d, #7b61ff, #25d366); filter: blur(10px); opacity: 0.7; }
  .neon-loader::after { width: 80%; height: 80%; top: 10%; left: 10%; background: linear-gradient(45deg, #7b61ff, #ff4d6d, #3b99f6); animation: pulse 2s linear infinite 0.5s; filter: blur(5px); opacity: 0.5; }
  .loading-text { font-size: 1.2rem; color: #fff; text-align: center; margin-top: 1rem; position: relative; }
  .loading-text span { position: relative; display: inline-block; animation: loadingText 2s ease-in-out infinite; }
  .loading-text span:nth-child(2) { animation-delay: 0.2s; } .loading-text span:nth-child(3) { animation-delay: 0.4s; } .loading-text span:nth-child(4) { animation-delay: 0.6s; } .loading-text span:nth-child(5) { animation-delay: 0.8s; } .loading-text span:nth-child(6) { animation-delay: 1s; } .loading-text span:nth-child(7) { animation-delay: 1.2s; }
  @keyframes pulse { 0%,100%{transform:scale(1);opacity:0.7}50%{transform:scale(1.2);opacity:0.9} }
  @keyframes loadingText { 0%,100%{transform:translateY(0);opacity:0.5}50%{transform:translateY(-10px);opacity:1} }
  #welcomeScreen { position: fixed; inset: 0; background: radial-gradient(circle at center, #0a0a0c 0%, #000 100%); z-index: 99998; display: flex; justify-content: center; align-items: center; opacity: 0; animation: welcomeFadeIn 0.8s ease-out forwards; pointer-events: auto; }
  @keyframes welcomeFadeIn { from { opacity: 0; } to { opacity: 1; } }
  .welcome-card { background: linear-gradient(145deg, rgba(20,20,25,0.9), rgba(10,10,12,0.8)); border-radius: 24px; padding: 3rem 2rem; width: 90%; max-width: 500px; text-align: center; border: 1px solid rgba(123,97,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.1); backdrop-filter: blur(20px) saturate(180%); transform: translateY(30px); animation: cardSlideUp 0.6s ease-out 0.3s forwards; }
  @keyframes cardSlideUp { to { transform: translateY(0); } }
  .welcome-title { color: #fff; font-size: 2.2rem; margin-bottom: 1rem; background: linear-gradient(45deg, #ff4d6d, #7b61ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 30px rgba(123,97,255,0.3); }
  .welcome-subtitle { color: rgba(255,255,255,0.8); font-size: 1.1rem; margin-bottom: 2rem; line-height: 1.6; }
  .welcome-features { display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; margin: 2rem 0; }
  .feature { background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 12px; width: 120px; transition: all 0.3s ease; opacity: 0; transform: translateY(8px); }
  .feature.show { opacity: 1; transform: translateY(0); }
  .feature:hover { background: rgba(123,97,255,0.1); transform: translateY(-5px); }
  .feature-icon { font-size: 2rem; margin-bottom: 0.5rem; }
  .feature-text { color: rgba(255,255,255,0.9); font-size: 0.9rem; }
  .welcome-button { background: linear-gradient(45deg, #ff4d6d, #7b61ff); color: white; border: none; padding: 1rem 2.5rem; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; margin-top: 1rem; box-shadow: 0 10px 20px rgba(123,97,255,0.3); }
  .welcome-button:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(123,97,255,0.4); }
  .welcome-button:active { transform: translateY(-1px); }
  .bg-layer{ position:fixed; inset:0; background-repeat:no-repeat; background-position:center; background-size:cover; pointer-events:none; will-change:transform; z-index:0; }
  #bg-back{filter: blur(2px) saturate(1.05) contrast(.95); transform: translateZ(0) scale(1.02); opacity:0.95}
  #bg-mid{mix-blend-mode:overlay; opacity:0.8; filter:contrast(1.05) saturate(1.1);}
  #bg-front{opacity:0.65; filter:brightness(.85) blur(.8px);}
  canvas#mainCanvas{position:fixed; inset:0; z-index:2; display:block; pointer-events:none;}
  #mainForm { position: fixed; z-index:9997; left:50%; top:50%; transform:translate(-50%,-50%); max-width:520px; width:92%; background: linear-gradient(180deg, rgba(10,10,12,0.6), rgba(10,10,12,0.55)); border-radius:18px; padding:22px; box-shadow: var(--shadow); border:1px solid rgba(255,255,255,0.04); text-align:center; color:#fff; backdrop-filter: blur(6px) saturate(120%); display: none; }
  #mainForm h2{margin:6px 0 8px; font-size:20px} #mainForm p{margin:0 0 14px; color:rgba(255,255,255,0.85)}
  .messenger{ position:fixed; width:56px; height:56px; border-radius:50%; background-size:cover; background-position:center; box-shadow: 0 12px 30px rgba(0,0,0,0.7); z-index:6; cursor:pointer; user-select:none; transform-origin:center; transition: transform .18s ease; will-change:transform,left,top; display: none; }
  .messenger:active{ transform: scale(.88) !important; }
  .halo{ position:fixed; width:60px;height:60px;border-radius:50%; filter:blur(12px); opacity:.8; pointer-events:none; z-index:5; mix-blend-mode:screen; display: none; }
  #dialog{ position:fixed; z-index:9999; pointer-events:none; background:var(--dialog-bg); color:#111; font-weight:700; padding:10px 16px; border-radius:12px; border:2px solid rgba(0,0,0,0.12); box-shadow: 0 10px 40px rgba(0,0,0,0.4); transform-origin:center; opacity:0; transition:opacity .35s, transform .35s; white-space:nowrap; }
  .sk-neon{ position:fixed; z-index:1; pointer-events:none; inset:0; mix-blend-mode:screen; opacity:0.7; }
  @media (max-width:520px){ .messenger{ width:44px; height:44px; } .halo{ width:62px; height:62px; } .welcome-card { padding: 2rem 1rem; } .welcome-title { font-size: 1.8rem; } }
</style>
</head>
<body>
<div id="loadingScreen">
  <div class="loading-content">
    <div class="neon-loader"></div>
    <div class="loading-text">
      <span>GhA</span>
      <span>SEM</span>
      <span>_ Slp</span>
    </div>
  </div>
</div>
<div id="welcomeScreen">
  <div class="welcome-card">
    <h1 class="welcome-title">ÿ®ŸÑÿÆÿ±Ÿá ÿßŸàŸÖÿØ€å</h1>
    <p class="welcome-subtitle">
      ÿÆ€åŸÑ€å ŸàŸÇÿ™Ÿá ÿß€åŸÜÿ¨ÿß ÿØÿßÿ¥ÿ™ŸÖ ÿ®ÿßÿ≤€å ŸÖ€å⁄©ÿ±ÿØŸÖ<br>ÿ™ÿß
      ÿ™Ÿà ÿ®ÿ™ŸàŸÜ€å ŸÖÿπŸÖÿß ÿ±Ÿà Ÿæ€åÿØÿß ⁄©ŸÜ€å Ÿà ÿß€åŸÜ ÿµŸÅÿ≠Ÿá ÿ±Ÿà Ÿæ€åÿØÿß ⁄©ŸÜ€å
    </p>
    <button id="enterButton" class="welcome-button">Ÿàÿ±ŸàÿØ</button>
    <p style="font-size:0.8rem; color:rgba(255,255,255,0.5); margin-top:2rem;">
      ŸÑÿ∑ŸÅÿß ÿ±Ÿà ÿØ⁄©ŸÖŸá ÿ®ÿßŸÑÿß ⁄©ŸÑ€å⁄© ⁄©ŸÜ ŸàŸÑ€å ÿ®ÿß ÿßÿ≠ÿ™€åÿßÿ∑
    </p>
  </div>
</div>
<div id="bg-back" class="bg-layer" style="background-image:url('./backiee-312480-landscape.jpg');"></div>
<div id="bg-mid" class="bg-layer" style="background-image:url('./backiee-312480-landscape.jpg'); transform:scale(1.06)"></div>
<div id="bg-front" class="bg-layer" style="background-image:url('./backiee-312480-landscape.jpg'); transform:scale(1.1)"></div>
<canvas id="mainCanvas"></canvas>
<canvas id="neonCanvas" class="sk-neon"></canvas>
<div id="mainForm" aria-live="polite"></div>
<a href="https://wa.me/+989389101977?text=ÿ≥ŸÑÿßŸÖ" target="_blank" id="whatsapp" class="messenger" style="background-image:url('./vecteezy_whatsapp-logo-icon_21495946.png')"></a>
<a href="https://instagram.com/Ghasem_slp" target="_blank" id="ig" class="messenger" style="background-image:url('./vecteezy_instagram-logo-icon_21495954.png')"></a>
<a href="https://t.me/Ghasem_slp" target="_blank" id="telegram" class="messenger" style="background-image:url('./d55851ab87ee65b7a7c772c52f962df9.png')"></a>
<div id="halo-w" class="halo" style="background:radial-gradient(circle, rgba(37,211,102,0.35), rgba(37,211,102,0.02));"></div>
<div id="halo-i" class="halo" style="background:radial-gradient(circle, rgba(255,64,129,0.35), rgba(255,64,129,0.02));"></div>
<div id="halo-t" class="halo" style="background:radial-gradient(circle, rgba(59,153,246,0.35), rgba(59,153,246,0.02));"></div>
<div id="dialog"></div>
<script>
let isFirstVisit = !localStorage.getItem('visited');
let isLoading = true;
let loadingProgress = 0;
let mainAppInitialized = false;
let audioCtx = null; 
let pointer = {x: window.innerWidth/2, y: window.innerHeight/2}; 
function showLoadingScreen(){
  const loadingScreen = document.getElementById('loadingScreen');
  loadingScreen.style.display = 'flex';
  loadingScreen.style.opacity = '1';
  const loadingInterval = setInterval(()=>{
    loadingProgress += Math.random()*20;
    if(loadingProgress >= 100){
      loadingProgress = 100; clearInterval(loadingInterval);
      setTimeout(()=>{
        loadingScreen.style.opacity = '0';
        setTimeout(()=>{
          loadingScreen.style.display = 'none';
          isLoading = false;
          if(isFirstVisit){
            showWelcomeScreen();
          } else {
            startMainApp();
          }
        }, 400);
      }, 400);
    }
  }, 180);
}
function showWelcomeScreen(){
  const welcomeScreen = document.getElementById('welcomeScreen');
  welcomeScreen.style.display = 'flex';
  welcomeScreen.style.opacity = '1';
  welcomeScreen.style.transform = 'scale(1)';
  const mainForm = document.getElementById('mainForm');
  if(mainForm) mainForm.style.display = 'none';
  const features = document.querySelectorAll('.feature');
  features.forEach((feature, i) => setTimeout(()=> feature.classList.add('show'), 200 + i*100));
}
function startMainApp(){
  document.querySelectorAll('.messenger, .halo').forEach(el => el.style.display = 'block');
  initMainApp();
}
function initMainApp(){
  if(mainAppInitialized) return;
  mainAppInitialized = true;
  console.log('Main app initializing...');
  try {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  } catch(e){
    audioCtx = null;
  }
  function playBeep(freq=440, time=0.08, type='sine', gain=0.03){
    if(!audioCtx) return;
    try {
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type; o.frequency.value = freq; g.gain.value = gain;
      o.connect(g); g.connect(audioCtx.destination);
      o.start();
      o.stop(audioCtx.currentTime + time);
    } catch(e){ }
  }
  const canvas = document.getElementById('mainCanvas');
  const ctx = canvas.getContext('2d');
  const neon = document.getElementById('neonCanvas');
  const nctx = neon.getContext('2d');
  function resizeAll(){
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    neon.width = window.innerWidth; neon.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeAll);
  resizeAll();
  const bgBack = document.getElementById('bg-back');
  const bgMid  = document.getElementById('bg-mid');
  const bgFront= document.getElementById('bg-front');
  function onPointerMove(e){
    pointer.x = e.clientX; pointer.y = e.clientY;
    const cx = (pointer.x / innerWidth - 0.5);
    const cy = (pointer.y / innerHeight - 0.5);
    bgBack.style.transform = `translate(${cx*6}px, ${cy*6}px) scale(1.02)`;
    bgMid.style.transform  = `translate(${cx*12}px, ${cy*12}px) scale(1.06)`;
    bgFront.style.transform= `translate(${cx*20}px, ${cy*20}px) scale(1.1)`;
  }
  window.addEventListener('pointermove', onPointerMove);
  let mouse = {x: innerWidth/2, y: innerHeight/2};
  addEventListener('pointermove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
  let sk = { x: innerWidth/2, y: innerHeight/2, vx:0, vy:0, state:'follow', respawnTimer:null, brokenParticles:[] };
  function drawSkeleton(x,y, t){
    nctx.clearRect(0,0,neon.width, neon.height);
    const g = nctx.createRadialGradient(x,y, 10, x,y, 220);
    g.addColorStop(0, 'rgba(160,120,255,0.14)');
    g.addColorStop(1, 'rgba(160,120,255,0)');
    nctx.fillStyle = g; nctx.fillRect(0,0,neon.width, neon.height);
    const bob = Math.sin(t*0.002)*2;
    ctx.lineWidth = 3 + (Math.abs(sk.vx)+Math.abs(sk.vy))*0.02;
    ctx.strokeStyle = '#fff';
    ctx.beginPath();
    ctx.arc(x, y-20 + bob, 14, 0, Math.PI*2);
    ctx.stroke();
    ctx.fillStyle = 'rgba(255,40,40,0.98)';
    ctx.beginPath(); ctx.arc(x-5, y-25 + bob, 3, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(x+5, y-25 + bob, 3, 0, Math.PI*2); ctx.fill();
    ctx.beginPath();
    ctx.moveTo(x, y-6 + bob); ctx.lineTo(x, y+30 + bob);
    ctx.moveTo(x, y); ctx.lineTo(x-22, y-10 + bob);
    ctx.moveTo(x, y); ctx.lineTo(x+22, y-10 + bob);
    ctx.moveTo(x, y+30); ctx.lineTo(x-18, y+55);
    ctx.moveTo(x, y+30); ctx.lineTo(x+18, y+55);
    ctx.stroke();
  }
  function explodeSkeleton(){
    sk.brokenParticles = [];
    for(let i=0;i<40;i++){
      sk.brokenParticles.push({
        x: sk.x, y: sk.y,
        vx: (Math.random()-0.5)*40, vy:(Math.random()-0.5)*40,
        r: 2 + Math.random()*5, life: 1 - Math.random()*0.6
      });
    }
    playBeep(120, 0.12, 'sawtooth', 0.05);
    clearTimeout(sk.respawnTimer);
    sk.respawnTimer = setTimeout(()=> {
      sk.x = innerWidth/2; sk.y = innerHeight/2; sk.vx = sk.vy = 0; sk.state='follow';
      for(let i=0;i<8;i++){ setTimeout(()=> playBeep(600 + i*40, 0.02, 'sine', 0.01), i*40); }
    }, 3000);
  }
  let lastT = performance.now();
  function renderAll(t){
    const dt = t - lastT;
    lastT = t;
    ctx.clearRect(0,0,canvas.width, canvas.height);
    if(sk.state === 'follow'){
      const dx = mouse.x - sk.x;
      const dy = mouse.y - sk.y;
      sk.vx += dx * 0.018; sk.vy += dy * 0.018;
      sk.vx *= 0.9; sk.vy *= 0.9;
      sk.x += sk.vx * (dt/16); sk.y += sk.vy * (dt/16);
      if(sk.x < 24 || sk.x > canvas.width - 24 || sk.y < 24 || sk.y > canvas.height - 24){
        sk.state = 'broken';
        explodeSkeleton();
      } else {
        drawSkeleton(sk.x, sk.y, t);
      }
    } else if(sk.state === 'broken'){
      sk.brokenParticles.forEach(p => {
        p.x += p.vx * (dt/16);
        p.y += p.vy * (dt/16);
        p.vy += 0.6 * (dt/16);
        p.r *= 0.995;
        ctx.fillStyle = 'rgba(255,255,255,0.95)';
        ctx.beginPath(); ctx.arc(p.x, p.y, Math.max(0.8,p.r), 0, Math.PI*2); ctx.fill();
      });
    }
    requestAnimationFrame(renderAll);
  }
  const agents = [
    { id:'whatsapp', el:document.getElementById('whatsapp'), halo:document.getElementById('halo-w'),
      x:120, y:120, vx:3.2, vy:2.6, radius:40, color:[37,211,102], freeze:false, lastCollision:0, trail:[] },
    { id:'ig', el:document.getElementById('ig'), halo:document.getElementById('halo-i'),
      x:360, y:300, vx:-3.6, vy:2.8, radius:40, color:[255,64,129], freeze:false, lastCollision:0, trail:[] },
    { id:'telegram', el:document.getElementById('telegram'), halo:document.getElementById('halo-t'),
      x:760, y:150, vx:2.6, vy:-3.4, radius:40, color:[59,153,246], freeze:false, lastCollision:0, trail:[] }
  ];
  const dialog = document.getElementById('dialog');
  function drawTrails(){
    ctx.fillStyle = 'rgba(0,0,0,0.08)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    agents.forEach(a=>{
      a.trail.push({x:a.x + a.radius/2, y:a.y + a.radius/2, life:120});
      if(a.trail.length > 60) a.trail.shift();
      for(let i=0;i<a.trail.length;i++){
        const p = a.trail[i];
        const alpha = (i / a.trail.length) * 0.35;
        ctx.beginPath();
        ctx.fillStyle = `rgba(${a.color[0]},${a.color[1]},${a.color[2]},${alpha})`;
        ctx.arc(p.x, p.y, (i/ a.trail.length) * 18, 0, Math.PI*2);
        ctx.fill();
      }
    });
  }
  function timeToCollision(A, B){
    const rx = B.x - A.x, ry = B.y - A.y;
    const rvx = B.vx - A.vx, rvy = B.vy - A.vy;
    const v2 = rvx*rvx + rvy*rvy;
    if(v2 < 0.01) return {will:false, t:Infinity};
    const t = -(rx*rvx + ry*rvy) / v2;
    if(t <= 0 || t > 2.2) return {will:false, t:Infinity};
    const cx = A.x + A.vx * t, cy = A.y + A.vy * t;
    const distAtT = Math.hypot((B.x + B.vx * t) - cx, (B.y + B.vy * t) - cy);
    return {will: distAtT < (A.radius + B.radius) * 1.1, t, cx, cy};
  }
  function aiDecide(A, B){
    const third = agents.find(x => x !== A && x !== B);
    const predict = timeToCollision(A,B);
    if(predict.will){
      const chanceCollision = 0.12;
      const relSpeed = Math.hypot(A.vx - B.vx, A.vy - B.vy);
      const luck = Math.random();
      if(luck < chanceCollision && relSpeed > 1.6) {
        return {action:'collide', at:predict};
      } else {
        if(third && Math.hypot(third.x - predict.cx, third.y - predict.cy) < 240){
          const awayX = third.x - predict.cx, awayY = third.y - predict.cy;
          const len = Math.hypot(awayX, awayY) || 1;
          third.vx += (awayX/len) * 3.5; third.vy += (awayY/len) * 3.5;
          return {action:'avoid', agent: third, at:predict};
        }
        const roomA = Math.min(A.x, innerWidth - A.x) + Math.min(A.y, innerHeight - A.y);
        const roomB = Math.min(B.x, innerWidth - B.x) + Math.min(B.y, innerHeight - B.y);
        const dodger = roomA < roomB ? A : B;
        const rx = B.x - A.x, ry = B.y - A.y;
        const perp = {x:-ry, y:rx};
        const plen = Math.hypot(perp.x, perp.y) || 1;
        const sign = (Math.random() > 0.5) ? 1 : -1;
        dodger.vx += (perp.x / plen) * 4 * sign; dodger.vy += (perp.y / plen) * 4 * sign;
        const other = (dodger === A) ? B : A; other.vx *= 0.86; other.vy *= 0.86;
        playBeep(600, 0.04, 'square', 0.01);
        return {action:'swerve', agent:dodger, at:predict};
      }
    }
    return {action:'none'};
  }
  function showCollisionDialog(x, y, A, B){
    const jokes = [
      "ÿØÿßÿØÿßÿ¥ ÿ™Ÿà ÿ®ÿß ⁄Üÿ¥ŸÖ ÿ®ÿ≥ÿ™Ÿá ÿ±ÿßŸÜŸÜÿØ⁄Ø€å ŸÖ€å‚Äå⁄©ŸÜ€å €åÿß ⁄©ŸÑÿßŸã ŸÖÿ∫ÿ≤ÿ™Ÿà ÿ¢Ÿàÿ±ÿØ€å ÿ™ÿπŸÖ€åÿ±⁄ØÿßŸáÿü! ü§¶‚Äç‚ôÇÔ∏è",
      "ÿ®Ÿá ŸÇÿ±ÿ¢ŸÜ €åŸá ÿ®ÿßÿ± ÿØ€å⁄ØŸá ÿ®ÿ≤ŸÜ€å ÿ®ŸáŸÖ ŸÖ€åÿØŸÖ ÿ¨ÿ±€åŸÖŸá‚Äåÿßÿ™Ÿà ŸÇŸàÿ∑€å ŸÜŸàÿ¥ÿßÿ®Ÿá ⁄©ŸÜŸÜ üò≠",
      "ÿ®ÿÆÿØÿß €åŸá ŸÑÿ≠ÿ∏Ÿá ŸÅ⁄©ÿ± ⁄©ÿ±ÿØŸÖ ⁄ØŸàÿ≤ŸÜ ÿßŸàŸÖÿØŸá ÿ¨ŸÑŸàŸÖÿå ÿØ€åÿØŸÖ ŸÜŸá ÿ™Ÿà€å€å!",
      "ÿ¢ÿÆŸá ÿÆÿß⁄© ÿ®ÿ± ÿ≥ÿ±ÿ™ ÿ®ÿß ÿß€åŸÜ ÿ±ÿßŸÜŸÜÿØ⁄Ø€åÿ™ÿåŸàÿß€å GPS ŸáŸÖ ŸáŸÜ⁄Ø ⁄©ÿ±ÿØ üòê",
      "ÿ®€åÿß Ÿæÿß€å€åŸÜ ÿ≠ÿ±ŸÅ ÿ®ÿ≤ŸÜ€åŸÖ! €åÿπŸÜ€å ÿ®€åÿß Ÿàÿ≥ÿ∑ ÿµŸÅÿ≠Ÿá ⁄©Ÿá ÿ®ÿ®€åŸÜŸÖÿ™ üëäü§£",
      "ŸÖŸÜ ÿ®ÿß ÿ™Ÿà ÿ™ÿµÿßÿØŸÅ ⁄©ÿ±ÿØŸÖ €åÿß ŸÇÿ∑ÿßÿ± ÿ¥Ÿáÿ±€åÿü ⁄Üÿ±ÿß ÿß€åŸÜŸÇÿØÿ± ÿ≥ÿ±ÿπÿ™ ÿØÿßÿ¥ÿ™€åÿü",
      "ÿ®€åÿÆ€åÿßŸÑ! ÿßÿµŸÑÿßŸã ÿ®Ÿá ÿØÿ±⁄©ÿå ŸÖŸÜ ⁄©Ÿá ÿ®€åŸÖŸá ÿ®ÿØŸÜŸá ÿØÿßÿ±ŸÖ üò≠",
      "⁄Ü€å ÿ¥ÿØÿü ÿÆŸàÿßÿ® ÿØ€åÿØ€å ÿÆŸÑÿ®ÿßŸÜ€åÿü ŸæŸèÿ¥ÿ™€å ÿ±Ÿà ŸàŸÑ ⁄©ŸÜ üò≠‚úàÔ∏è",
      "ÿ®ÿ®€åŸÜ ŸáŸÖ€åŸÜ ÿßŸÑÿßŸÜ ÿ®ÿ±Ÿà ÿ¢ÿ≤ŸÖŸàŸÜ ÿ±ÿßŸáŸÜŸÖÿß€å€å Ÿà ÿ±ÿßŸÜŸÜÿØ⁄Ø€åÿå ŸÑÿ∑ŸÅÿßŸã ŸÇÿ®ŸàŸÑ ŸÜÿ¥Ÿà‚Ä¶",
      "⁄Üÿ¨Ÿàÿ±€å ÿ™ŸàŸÜÿ≥ÿ™€å ÿ™Ÿà ŸÅÿ∂ÿß€å 2D ÿ®ÿß ŸÖŸÜ ÿ™ÿµÿßÿØŸÅ ⁄©ŸÜ€åÿü ÿßŸÅÿ™ÿÆÿßÿ± ÿ®ÿ≤ÿ±⁄Ø€åŸá ŸàÿßŸÇÿπÿßŸã üòêüòÇ",
      "ÿ®Ÿà€å ⁄Øÿßÿ≤ ŸÖ€åÿßÿØ‚Ä¶ ŸÜ⁄©ŸÜŸá ÿßÿ≤ ŸÖÿ∫ÿ≤ÿ™ ÿ®ÿßÿ¥Ÿá ÿ≥ŸàÿÆÿ™Ÿáÿü",
      "Ÿàÿß€åÿ≥ÿßÿØ€å Ÿàÿ≥ÿ∑ ÿ¨ÿßÿØŸá ÿπ⁄©ÿ≥ Ÿæÿ±ŸàŸÅÿß€åŸÑ ÿ®⁄Ø€åÿ±€åÿü üòÇ",
      "ŸÖÿßŸÖÿßŸÜÿ™ ⁄ØŸÅÿ™Ÿá ÿ®ÿß ⁄ØŸàÿ¥€å ÿ®ÿßÿ≤€å ŸÖ€å‚Äå⁄©ŸÜ€å ÿ®ÿß ŸÖŸÜ ÿ™ÿµÿßÿØŸÅ ŸÜ⁄©ŸÜÿü ü§£",
      "ŸÑÿπŸÜÿ™€å ⁄Øÿ±ÿØŸÜ ŸÖŸÜ ⁄©ÿ¨ ÿ¥ÿØ!",
      "ÿØÿßÿØÿßÿ¥ ÿß€åŸÜÿ¨ÿß Ÿæ€åÿ≥ÿ™ ŸÅÿ±ŸÖŸàŸÑ €å⁄© ŸÜ€åÿ≥ÿ™ÿå ÿ®Ÿæ€å⁄Ü!",
      "ÿÆÿ®ÿü ⁄Ü€å ÿ¥ÿØÿü ŸÅ⁄©ÿ± ⁄©ÿ±ÿØ€å GTA ÿ®ÿßÿ≤€å ŸÖ€å‚Äå⁄©ŸÜ€åÿü! üöóüí•",
      "ÿØÿßÿ¥ ⁄ØŸÑŸÖÿå ÿ™Ÿà ÿßŸÑ⁄©€å ÿ®ÿß ŸÖŸÜ ÿ™ÿµÿßÿØŸÅ ⁄©ÿ±ÿØ€å ⁄©Ÿá ÿ≠ÿ±ŸÅ ÿ®ÿ≤ŸÜ€å ŸÜŸáÿü üòé",
      "ŸÖÿÆŸÅÿ™ ⁄©ÿ±ÿØ€å ÿ®ÿ±ÿßÿØÿ±ÿü €åŸáŸà ⁄©Ÿàÿ®€åÿØ€å ÿ±ŸàŸÖ üòê",
      "ÿ™Ÿà ÿ±Ÿà ÿÆÿØÿß ÿ®Ÿá ŸÖŸÜ ŸÜÿ≤ŸÜ ÿØ€å⁄ØŸáÿå ŸÖŸÜ ÿ™ÿßÿ≤Ÿá ÿßÿ≤ ÿµÿßŸÅ⁄©ÿßÿ±€å ÿ®ÿ±⁄Øÿ¥ÿ™ŸÖ üò≠",
      "ÿ¢ÿ®ÿ¨€å‚Äåÿ™Ÿà ÿ¢Ÿàÿ±ÿØ€å ÿ±ÿßŸÜŸÜÿØ⁄Ø€åÿü ⁄Üÿ±ÿß ÿßŸÜŸÇÿØ ÿ®ÿØÿü üòÇ",
      "ŸÖŸÜ ŸÖŸÇÿµÿ± ŸÜ€åÿ≥ÿ™ŸÖ! ÿ™Ÿà ŸÜÿ®ŸàÿØ€åÿü ŸÖŸÜ ŸÜÿ®ŸàÿØŸÖ! ⁄©€å ÿ®ŸàÿØÿü!",
      "ŸàŸÇÿ™€å ⁄ØŸÅÿ™ŸÜ 'ÿßÿ≤ ⁄ÜŸæ ÿ®ÿ±ÿßŸÜ' ŸÖŸÜÿ∏Ÿàÿ±ÿ¥ ÿß€åŸÜ ŸÜÿ®ŸàÿØ ⁄©Ÿá ÿ®€åÿß€å ÿ™Ÿà ŸÖÿ∫ÿ≤ ŸÖŸÜ üòí",
      "ÿß€å ÿ®ÿßÿ®ÿß ÿØŸàÿ®ÿßÿ±Ÿá ÿ®ÿß€åÿØ Ÿæÿ±€åŸÜÿ™ ÿÆÿ≥ÿßÿ±ÿ™ ÿ®⁄Ø€åÿ±ŸÖ",
      "GPS ŸáŸÖ€åŸÜÿ¨Ÿàÿ±€å ⁄ØŸÅÿ™ 'ÿ®ÿ±⁄Øÿ¥ÿ™ ÿ∫€åÿ±ŸÖÿ¨ÿßÿ≤'‚Ä¶",
      "ŸÖŸÜ ÿ≠ÿ≥ ⁄©ÿ±ÿØŸÖ €åŸá ÿ≥ÿß€åŸá ÿßŸàŸÖÿØ ÿ∑ÿ±ŸÅŸÖ‚Ä¶ ÿ®ÿπÿØ ÿØ€åÿØŸÖ ÿ™Ÿà€å€å üòê",
      "ÿØŸàÿ®ÿßÿ±Ÿá ÿ®Ÿá ŸÖŸÜ ÿ≤ÿØ€åÿü €åÿπŸÜ€å ÿ±Ÿàÿ≠€åÿü ⁄Üÿ±ÿß ÿßÿ≤ ÿØŸàÿ± ÿ∏ÿßŸáÿ± ÿ¥ÿØ€åÿü",
      "ŸÜÿ≤ŸÜ ŸÜÿ≤ŸÜ ŸÜÿ≤ŸÜ‚Äîÿ¢ÿÆ!",
      "ÿ™Ÿà ŸÖÿ∑ŸÖÿ¶ŸÜ€å ÿßŸÜÿ≥ÿßŸÜ Ÿæ€åÿ¨ ŸÇÿ®ŸÑ€å ŸÜ€åÿ≥ÿ™€åÿü üò≠üíÄ",
      "¬´ÿØÿßÿØÿßÿ¥ ⁄Üÿ±ÿß ÿ≤ÿØ€å ÿ®Ÿá ŸÖŸÜÿü!¬ª ¬´ÿßŸêÿ¥ÿ™ÿ®ÿßŸá ÿßÿ≤ ÿ™Ÿà ÿ®ŸàÿØÿå ÿØÿßÿ¥ÿ™ŸÖ ÿ±ÿØ ŸÖ€åÿ¥ÿØŸÖ!¬ª",
      "¬´ŸÜ⁄ØÿßŸá ⁄©ŸÜ ⁄ÜŸá ÿ®Ÿá ÿ≥ÿ±ŸÖ ÿ¢Ÿàÿ±ÿØ€å!¬ª ¬´ÿ®ÿ±Ÿà ÿÆÿØÿß ÿ±Ÿàÿ≤€åÿ™Ÿà ÿ¨ÿß€å ÿØ€å⁄ØŸá ÿ®ÿØŸá üò≠„Äè",
      "¬´ÿØŸàÿ®ÿßÿ±Ÿá ÿÆŸàÿ±ÿØ€å ÿ®ŸáŸÖ!¬ª ¬´ŸÇÿ≥ŸÖ ŸÖ€å‚ÄåÿÆŸàÿ±ŸÖ ÿµŸÅÿ≠Ÿá ⁄©Ÿà⁄Ü€å⁄© ÿ®ŸàÿØ!¬ª",
      "¬´⁄Üÿ±ÿß ŸÑÿß€å€å ⁄©ÿ¥€åÿØ€åÿü¬ª ¬´⁄ÜŸàŸÜ ÿ™Ÿà Ÿàÿ≥ÿ∑ ÿ¨ÿßÿØŸá ⁄Üÿ±ÿ™ ŸÖ€åÿ≤ÿØ€å!¬ª",
      "ŸÖŸÜ ÿ±ÿßŸÜŸÜÿØ⁄Ø€å ÿ®ŸÑÿØ ŸÜ€åÿ≥ÿ™ŸÖÿå ⁄ØŸÜÿßŸá ÿØÿßÿ±ŸÖ ÿ®ŸáŸÖ ŸÜÿ≤ŸÜ üòê",
      "ÿ®ÿ≤ŸÜ ÿ®ÿ≤ŸÜÿå ŸÖŸÜ ŸáŸÖ€åŸÜ€å ⁄©Ÿá Ÿáÿ≥ÿ™ŸÖ üò≠",
      "ÿØÿßÿØÿßÿ¥ ÿ™ŸÇÿµ€åÿ± ÿ™Ÿà ŸÜ€åÿ≥ÿ™‚Ä¶ ŸÖŸÜ ÿÆ€åŸÑ€å ÿÆŸàÿ¥⁄ØŸÑŸÖÿå ŸáŸÖŸá ŸÖ€å‚ÄåÿÆŸàÿßŸÜ ÿ®ÿÆŸàÿ±ŸÜ ÿ®ŸáŸÖ üòé",
      "ŸÖŸÜ €åŸá ÿ¢€å⁄©ŸàŸÜ ÿ®€å⁄Üÿßÿ±Ÿá‚ÄåÿßŸÖÿå ⁄Üÿ±ÿß ÿß€åŸÜ ŸáŸÖŸá ÿÆÿ¥ŸàŸÜÿ™ÿü",
      "ŸÖÿ≥€åÿ±ŸÖŸàŸÜ €å⁄©€åŸá‚Ä¶ ŸàŸÑ€å ÿ®ÿ±ÿÆŸàÿ±ÿØ ŸÑÿßÿ≤ŸÖ ŸÜÿ®ŸàÿØ üò©",
      "ŸàŸÇÿ™€å ÿ≥ÿ±ÿπÿ™ÿ™ ÿßÿ≤ ŸÜŸàÿ± ÿ®€åÿ¥ÿ™ÿ±Ÿáÿå ÿ™ÿµÿßÿØŸÅ ÿ∑ÿ®€åÿπ€å ŸÖ€åÿ¥Ÿá ü§£",
      "ÿßÿ≤ ÿ¨ŸÑŸàÿ™ ÿØÿ± ÿ±ŸÅÿ™ŸÖÿå ÿßÿ≤ Ÿæÿ¥ÿ™ ÿÆŸàÿ±ÿØ€å ÿ®ŸáŸÖ. ÿß€åŸÜ ŸáŸÜÿ± ŸÖ€åÿÆŸàÿßÿØ üò≠",
      "ŸÖŸÜ ÿØÿ¥ŸÖŸÜ ÿ™Ÿà ŸÜ€åÿ≥ÿ™ŸÖÿå ŸàŸÑ€å ÿ™Ÿà ÿØÿßÿ±€å ÿ™ŸÑÿßÿ¥ ŸÖ€å‚Äå⁄©ŸÜ€å ÿ®ÿßÿ¥ŸÖ",
      "ŸÜÿ≤ŸÜ‚Äî⁄©ŸèÿØ ŸÖŸÜŸà ÿÆÿ∑ÿß ŸÖ€åŸÜÿØÿßÿ≤€å üò≠",
      "ŸÖŸÜ ŸáŸÜŸàÿ≤ ŸÑŸàÿØ ŸÜÿ¥ÿØŸÖÿå Ÿàÿß€åÿ≥ÿßÿßÿß‚Äî",
      "ŸáŸàŸàŸàŸàŸàŸÅÿå ŸÜÿ≤ÿØ€å⁄© ÿ®ŸàÿØ CSSŸÄŸÖ Ÿæÿßÿ±Ÿá ÿ¥Ÿá!",
      "ÿØÿßÿØÿßÿ¥ €åŸá ÿ≥ÿßŸÜÿ™ ŸÖŸàŸÜÿØŸá ÿ®ŸàÿØ Ÿæÿß⁄© ÿ¥ŸÖ ÿßÿ≤ ÿµŸÅÿ≠Ÿá",
      "ŸÖŸÜ ŸæŸèÿ±ŸÅŸàÿ±ŸÖŸÜÿ≥ Ÿæÿß€å€åŸÜ ÿØÿßÿ±ŸÖÿå ÿ®ÿßŸáÿßŸÖ ÿ¢ÿ±ŸàŸÖ ÿ®ÿ±ÿÆŸàÿ±ÿØ ⁄©ŸÜ üòÇ"
    ];
    dialog.style.left = (x) + 'px';
    dialog.style.top  = (y) + 'px';
    dialog.innerText = jokes[Math.floor(Math.random()*jokes.length)];
    dialog.style.opacity = 1;
    dialog.style.transform = 'translateY(-6px) scale(1)';
    A.halo.style.opacity = 1; B.halo.style.opacity = 1;
    A.el.style.transform = 'scale(1.08) rotate(' + ((Math.random()-0.5)*8) + 'deg)';
    B.el.style.transform = 'scale(1.08) rotate(' + ((Math.random()-0.5)*8) + 'deg)';
    setTimeout(()=>{
      dialog.style.opacity = 0;
      dialog.style.transform = 'translateY(0) scale(.98)';
      A.halo.style.opacity = 0.28; B.halo.style.opacity = 0.28;
      A.el.style.transform = ''; B.el.style.transform = '';
    }, 3000);
  }
  function handleCollision(A,B, cx, cy){
    const now = Date.now();
    A.lastCollision = B.lastCollision = now;
    A.freeze = true; B.freeze = true;
    showCollisionDialog(cx, cy, A, B);
    const saveA = {vx:A.vx, vy:A.vy}, saveB = {vx:B.vx, vy:B.vy};
    playBeep(220, 0.22, 'sawtooth', 0.06);
    A.vx = -saveA.vx * 0.6; A.vy = -saveA.vy * 0.6;
    B.vx = -saveB.vx * 0.6; B.vy = -saveB.vy * 0.6;
    setTimeout(()=>{
      A.vx = (Math.random()-0.5)*4 + (A.x < B.x ? -3 : 3);
      A.vy = (Math.random()-0.5)*4;
      B.vx = (Math.random()-0.5)*4 + (B.x < A.x ? -3 : 3);
      B.vy = (Math.random()-0.5)*4;
      A.freeze = B.freeze = false;
    }, 3000);
  }
  requestAnimationFrame(renderAll);
  requestAnimationFrame(function updateAgents(){
    drawTrails();
    const now = Date.now();
    agents.forEach(a=>{
      if(!a.freeze && Math.random() < 0.01){
        a.vx += (Math.random()-0.5)*1.2; a.vy += (Math.random()-0.5)*1.2;
      }
      if(!a.freeze){ a.x += a.vx; a.y += a.vy; } else { a.x += (Math.random()-0.5)*0.2; a.y += (Math.random()-0.5)*0.2; }
      if(a.x < 6){ a.x = 6; a.vx = Math.abs(a.vx) * 0.9; }
      if(a.y < 6){ a.y = 6; a.vy = Math.abs(a.vy) * 0.9; }
      if(a.x > innerWidth - 6 - (a.el.clientWidth || 86)){ a.x = innerWidth - 6 - (a.el.clientWidth || 86); a.vx = -Math.abs(a.vx) * 0.9; }
      if(a.y > innerHeight - 6 - (a.el.clientHeight || 86)){ a.y = innerHeight - 6 - (a.el.clientHeight || 86); a.vy = -Math.abs(a.vy) * 0.9; }
      a.el.style.left = a.x + 'px'; a.el.style.top = a.y + 'px';
      a.halo.style.left = (a.x + (a.el.clientWidth||86)/2 - (a.halo.clientWidth||120)/2) + 'px';
      a.halo.style.top  = (a.y + (a.el.clientHeight||86)/2 - (a.halo.clientHeight||120)/2) + 'px';
      a.halo.style.opacity = 0.28;
    });
    for(let i=0;i<agents.length;i++){
      for(let j=i+1;j<agents.length;j++){
        const A = agents[i], B = agents[j];
        if(Date.now() - Math.max(A.lastCollision||0, B.lastCollision||0) < 900) continue;
        const predict = timeToCollision(A,B);
        if(predict.will){
          const decision = aiDecide(A,B);
          if(decision.action === 'collide'){ handleCollision(A,B, predict.cx, predict.cy); }
        }
      }
    }
    for(let aIdx=0;aIdx<agents.length;aIdx++){
      for(let bIdx=aIdx+1;bIdx<agents.length;bIdx++){
        const A = agents[aIdx], B = agents[bIdx];
        const dx = (A.x - B.x), dy = (A.y - B.y);
        const d = Math.hypot(dx,dy);
        if(d < (A.radius + B.radius) * 0.9){
          if(!A.freeze && !B.freeze && Math.random() < 0.66){
            handleCollision(A,B, (A.x+B.x)/2, (A.y+B.y)/2);
          } else {
            const nx = dx/d || 0.01; const ny = dy/d || 0.01;
            const push = (A.radius + B.radius) - d + 3;
            A.x += nx * (push*0.5); B.x -= nx * (push*0.5);
            A.y += ny * (push*0.5); B.y -= ny * (push*0.5);
          }
        }
      }
    }
    requestAnimationFrame(updateAgents);
  });
  const mainForm = document.getElementById('mainForm');
  if(isFirstVisit){
    if(mainForm) mainForm.style.display = 'none';
  } else {
    if(mainForm) mainForm.style.display = 'none';
  }
  document.addEventListener('pointerdown', ()=>{ if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume(); }, {once:true});
}
document.addEventListener('DOMContentLoaded', ()=>{
  const enterBtn = document.getElementById('enterButton');
  const welcomeScreen = document.getElementById('welcomeScreen');
  enterBtn.addEventListener('click', ()=>{
    localStorage.setItem('visited','true');
    isFirstVisit = false;
    welcomeScreen.style.opacity = '0';
    welcomeScreen.style.transform = 'scale(0.96)';
    setTimeout(()=>{
      welcomeScreen.style.display = 'none';
      startMainApp();
      if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
    }, 360);
  });
  showLoadingScreen();
});
if(!isFirstVisit && !isLoading){
  startMainApp();
}
</script>
</body>
</html>
